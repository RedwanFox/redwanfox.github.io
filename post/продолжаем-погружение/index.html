<!DOCTYPE html>
<html lang="ru-ru">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Продолжаем погружение | Power Of The Sword Derivative</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/about/">About</a></li>
      
    </ul>
    <hr/>
    </nav>


<div class="article-meta">
<h1><span class="title">Продолжаем погружение</span></h1>

<h2 class="date">2022/01/27</h2>
<p class="terms">
  
  
  
  
  Tags: <a href="/tags/%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0">разработка</a> 
  
  
</p>
</div>


<main>
<p>За неделю сидения по вечерам всякие интересные штуки случались. 3.5 эпопеи ниже.</p>
<h2 id="шрифтовые-всратости">Шрифтовые Всратости</h2>
<p>Продолжаю использовать пиксель-арт и низкие разрешения для своей демки. Стандартные настройки шрифтов движка на таких настройках работают весьма плохо.</p>
<p><img src="/images/photo_2022-01-24_22-41-40.jpg" alt="Стандартная тема движка">
Стандартная тема движка</p>
<p>Шрифт расплывается при скейлинге и режет глаза. Взял шрифт <a href="https://poppyworks.itch.io/silver">Silver</a>, сделанный специально для таких случаев. В нем даже поддержка кириллицы есть.</p>
<p>В движке можно выставить глобальную тему ui-контролов, но как выяснилось оверрайд шрифта на ее уровне не работает и надо вставлять в каждый виджет руками. Хорошо, вышла бета новой минорной версии, в ней починили, вот <a href="https://github.com/godotengine/godot/pull/55497">pull request</a>. Конечно же его замерджили через пол дня после отведения версии. Ок, собрал кастомную версию godot от последних на тот момент коммитов и подключил.</p>
<p><img src="/images/photo_2022-01-24_22-45-37.jpg" alt="Подключил silver с однопиксельной обводкой.">
Подключил silver с однопиксельной обводкой.</p>
<p>Теперь выглядит куда менее всрато.</p>
<h2 id="интересности-с-lto">Интересности с LTO</h2>
<p>С движком на этом приключения не закончились - загнал его как submodule в репозиторий и добавил в общую сборку. Заодно протестировал сборку godot с LTO. Полноценный бенчмарк не делал. Визуально время старта редактора упало с 1-2 секунды до мгновенного, но вот время сборки с msvc увеличилось на 6-7 минут, а бинарь разросся на 12Mb.</p>
<p>Попробовал провернуть то же самое на линуксе. GCC выдает подобные результаты, а в официальной бинарной поставке Clang LTO сломано. Эпопею по сборке LLVM оставлю до лучших времен.</p>
<h2 id="ботцы-налетели">Ботцы налетели</h2>
<p>Пощупал пару основных техник для реализации поведения ИИ в играх с целью выбора, что использовать в дальнейшем. До этого ни разу не притрагивался к ботам на практике - только статьи читал, да доклады с GDC смотрел.</p>
<p>Смотрел Finite State Machines (FSM в дальнейшем), они же конечные автоматы, и Behaviour Trees (btrees).</p>
<p>Поставил себе задачу запилить и там и там бота, который имеет 3 поведения: стоять, ходить и говорить. Для каждой техники использовал готовые опенсорсные плагины для godot с самими структурами данных и готовыми визуальными редакторами.</p>
<p>Немного выводов</p>
<p>FSM:</p>
<ol>
<li>Интуитивно понятно, что происходит и просто как грабли.</li>
<li>Обратная сторона простоты - состояния FSM протекают друг в друга -&gt; не получится сделать переносимый код.</li>
<li>При этом вполне подойдет для переключения стейтов игры / стейтов интерфейса.</li>
<li>На больших FSMах будет сильно расти связность между стейтами. Частично проблему решают иерархические FSM (стейт = дочерний FSM), но все равно все не то.</li>
</ol>
<p>Btree:</p>
<ol>
<li>Тоже достаточно интуитивно, как и FSM-ы.</li>
<li>Любой FSM можно представить как btree.</li>
<li>Логические блоки btree вполне переносимы.</li>
<li>Конечно же пришлось патчить библиотеку, чтобы написать бота без костылей.</li>
</ol>
<p>В дальнейшем для ботов буду пользоваться behaviour trees. Еще надо попробовать утилитные системы и планировщики для моделирования высокоуровневой стратегии для организации или какой-нибудь фракции.</p>
<p>ЗЫ. Использованные плагины: <a href="https://github.com/imjp94/gd-YAFSM">gd-YAFSM</a> для FSM и <a href="https://github.com/fian46/addons-btree">addons-btree</a> для behaviour tree</p>
<p>ЗЗЫ</p>

<p>Бот на FSM. BTree-шный бот ведет себя идентично.</p>

</main>

  <footer>
  
  
  <hr/>
  © <a href="https://github.com/RedwanFox">Github</a> | <a href="https://t.me/power_of_the_sword_derivative">Telegram</a>
  
  </footer>
  </body>
</html>

